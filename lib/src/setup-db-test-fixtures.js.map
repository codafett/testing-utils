{"version":3,"file":"setup-db-test-fixtures.js","sourceRoot":"","sources":["../../src/setup-db-test-fixtures.ts"],"names":[],"mappings":";AAAA,yEAAyE;AACzE,sDAAsD;;;;;;AAEtD,qCAAoD;AACpD,6DAA6D;AAC7D,6EAAuE;AAEvE,8EAAoD;AAGpD,SAAgB,iBAAiB,CAC/B,UAAU,EACV,gBAAkC,EAClC,kBAAuC;IAEvC,IAAI,gBAAkC,CAAC;IACvC,SAAS,CAAC,KAAK,IAAI,EAAE;QACnB,gBAAgB,GAAG,IAAI,4BAAgB,CACrC,gBAAgB,EAChB,kBAAkB,CACnB,CAAC;QACF,MAAM,UAAU,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,CAAC;IACzD,CAAC,CAAC,CAAC;IACH,QAAQ,CAAC,KAAK,IAAI,EAAE;QAClB,MAAM,IAAA,uBAAa,GAAE,CAAC,KAAK,EAAE,CAAC;IAChC,CAAC,CAAC,CAAC;IACH,IAAI,oBAA8C,CAAC;IACnD,UAAU,CAAC,KAAK,IAAI,EAAE;QACpB,MAAM,UAAU,GAAe,MAAM,IAAA,uBAAa,GAAE,CAAC;QACrD,oBAAoB,GAAG,IAAI,sDAAwB,CAAC,UAAU,CAAC,CAAC;QAChE,MAAM,oBAAoB,CAAC,KAAK,EAAE,CAAC;IACrC,CAAC,CAAC,CAAC;IACH,SAAS,CAAC,KAAK,IAAI,EAAE;QACnB,MAAM,oBAAoB,CAAC,MAAM,EAAE,CAAC;IACtC,CAAC,CAAC,CAAC;AACL,CAAC;AAzBD,8CAyBC","sourcesContent":["// wait for the database connection and make sure to close it afterwards.\n/* eslint-disable import/no-extraneous-dependencies */\n\nimport { Connection, getConnection } from 'typeorm';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { TransactionalTestContext } from 'typeorm-transactional-tests';\n\nimport DbConfigSettings from './db-config-settings';\nimport { ConnectionSettings, DatabaseSettings } from './types';\n\nexport function setUpTestFixtures(\n  sqlFactory,\n  databaseSettings: DatabaseSettings,\n  connectionSettings?: ConnectionSettings,\n) {\n  let dbConfigSettings: DbConfigSettings;\n  beforeAll(async () => {\n    dbConfigSettings = new DbConfigSettings(\n      databaseSettings,\n      connectionSettings,\n    );\n    await sqlFactory(dbConfigSettings.testDbDefaultConfig);\n  });\n  afterAll(async () => {\n    await getConnection().close();\n  });\n  let transactionalContext: TransactionalTestContext;\n  beforeEach(async () => {\n    const connection: Connection = await getConnection();\n    transactionalContext = new TransactionalTestContext(connection);\n    await transactionalContext.start();\n  });\n  afterEach(async () => {\n    await transactionalContext.finish();\n  });\n}\n"]}