{"version":3,"file":"server-utils.js","sourceRoot":"","sources":["../../../src/utils/server-utils.ts"],"names":[],"mappings":";;;;;;AAAA,0DAA4C;AAC5C,qCAAiC;AACjC,6DAA6D;AAC7D,0DAAgC;AAEzB,KAAK,UAAU,eAAe,CACnC,WAA+C;IAE/C,MAAM,MAAM,GAAW,IAAA,gBAAM,EAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;IAEhD,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;IAExD,MAAM,GAAG,GAAG,MAAM,IAAA,oBAAG,EAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IAClC,IAAI,MAAe,CAAC;IACpB,IAAI,KAAc,CAAC;IAEnB,MAAM,SAAS,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QACxC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE;YACvB,KAAK,GAAG,mBAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC3B,OAAO,CAAC,KAAK,CAAC,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,MAAM,SAAS,CAAC;IAChB,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;AAChC,CAAC;AApBD,0CAoBC","sourcesContent":["import { web } from '@tiney/infrastructure';\nimport { Router } from 'express';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport request from 'supertest';\n\nexport async function createServerApp(\n  routeConfig: [{ path: string; router: Router }],\n) {\n  const routes: Router = Router({ strict: true });\n\n  routeConfig.map((rc) => routes.use(rc.path, rc.router));\n\n  const app = await web({ routes });\n  let server: unknown;\n  let agent: unknown;\n\n  const getServer = new Promise((resolve) => {\n    server = app.listen(() => {\n      agent = request.agent(app);\n      resolve(agent);\n    });\n  });\n\n  await getServer;\n  return { app, server, agent };\n}\n"]}