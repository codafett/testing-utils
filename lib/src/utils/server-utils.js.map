{"version":3,"file":"server-utils.js","sourceRoot":"","sources":["../../../src/utils/server-utils.ts"],"names":[],"mappings":";;;;;;AAAA,qCAA0C;AAC1C,0DAAgC;AAEzB,KAAK,UAAU,eAAe,CACnC,GAAyD,EACzD,WAA+C;IAE/C,MAAM,MAAM,GAAW,IAAA,gBAAM,EAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;IAEhD,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;IAExD,MAAM,UAAU,GAAG,MAAM,GAAG,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IACzC,IAAI,MAAe,CAAC;IACpB,IAAI,KAAc,CAAC;IAEnB,MAAM,SAAS,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QACxC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,GAAG,EAAE;YAC9B,KAAK,GAAG,mBAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAClC,OAAO,CAAC,KAAK,CAAC,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,MAAM,SAAS,CAAC;IAChB,OAAO,EAAE,UAAU,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;AACvC,CAAC;AArBD,0CAqBC","sourcesContent":["import { Router, Express } from 'express';\nimport request from 'supertest';\n\nexport async function createServerApp(\n  app: ({ routes }: { routes: Router }) => Promise<Express>,\n  routeConfig: [{ path: string; router: Router }],\n) {\n  const routes: Router = Router({ strict: true });\n\n  routeConfig.map((rc) => routes.use(rc.path, rc.router));\n\n  const expressApp = await app({ routes });\n  let server: unknown;\n  let agent: unknown;\n\n  const getServer = new Promise((resolve) => {\n    server = expressApp.listen(() => {\n      agent = request.agent(expressApp);\n      resolve(agent);\n    });\n  });\n\n  await getServer;\n  return { expressApp, server, agent };\n}\n"]}